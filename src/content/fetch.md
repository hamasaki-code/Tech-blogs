---
title: "fetchってなに？検索ボタンの裏側をやさしく解説"
date: "2025-07-03"
tags: ["Next.js"]
---

# fetchってなに？検索ボタンの中でどう動いてるかをやさしく解説

「検索ボタンを押したら、画面にお店が表示される」
その裏側で `fetch` がどんな仕事をしているのかを、高校生でもわかるように説明します！

## ✅ そもそも `fetch` ってなに？

`fetch` は、「外のサーバーから情報を取ってくる」ための命令です。
スマホで「今の天気を表示する」ようなアプリも、裏ではこれを使ってサーバーから天気情報をもらっています。

## 🧩 今回のケース：お店を検索するアプリ

- 検索条件（場所とジャンル）を入力する
  例：「渋谷 × 焼肉」
- ボタンを押すと、条件に合ったお店を3件だけ表示する
- そのときに使っているのが `fetch`！

## 🧪 実際のコード

```tsx
const handleSearch = async () => {
  if (!area || !genre) return;

  setLoading(true);
  try {
    const res = await fetch(`http://localhost:3000/api/shops?area=${area}&genre=${genre}`);
    const data = await res.json();
    setShops(data);
  } catch (err) {
    console.error('APIエラー:', err);
  } finally {
    setLoading(false);
  }
};
```

## 🔍 このコードがやってること（1ステップずつ解説）

### ① 「場所」と「ジャンル」が空なら、検索しない

```tsx
if (!area || !genre) return;
```

> 入力されていない場合、何もせず終わります。
> 無駄なアクセスを防ぐためのチェックです。

### ② 読み込み中マークを表示する

```tsx
setLoading(true);
```

> 「いま検索してるよ〜」とユーザーに伝えるための状態フラグです。
> 画面に「読み込み中...」などが出るように使います。

### ③ fetchでサーバーにデータをお願いする

```tsx
const res = await fetch(`http://localhost:3000/api/shops?area=${area}&genre=${genre}`);
```

> `fetch` は「この場所とジャンルに合うお店ある？」とサーバーにお願いする部分です。
> このコードでは、`localhost:3000` で動いてるRails APIに聞いています。

### ④ もらったデータを画面にセット

```tsx
const data = await res.json();
setShops(data);
```

> サーバーが返してくれたデータ（お店のリスト）を表示用の変数に入れます。
> `res.json()` でJSON形式のデータをJavaScriptの形に変換しています。

### ⑤ 失敗したときはエラーをログに出す

```tsx
console.error('APIエラー:', err);
```

> ネットが切れていたり、サーバーが止まっていたりするとここでキャッチされます。
> `console.log` に出して、開発中に原因を調べやすくしています。

### ⑥ 最後に「読み込み中」マークを消す

```tsx
setLoading(false);
```

> 成功しても失敗しても、読み込み中フラグを**元に戻して**終了します。
> これがないと、ずっと「検索中…」が出続けることになります。

## ✨ まとめ：fetchの流れを知っておこう

`fetch` を使うと、

1. サーバーにお願いをして
2. 返ってきたデータを受け取り
3. 画面に表示する

という一連の流れが作れます。

このコードでは、さらに

- 入力チェック
- 読み込み状態の制御
- エラー対応

も入っているので、**ユーザーにやさしい作り**になっています！

## 🎯 このブログが合いそうな人

- fetchって何？という初学者
- Next.jsとAPIのつなぎこみに入ったばかりの人
- 状態管理やUIの気遣いも覚えたい人

## ✍ 最後に

コードが全部わからなくても、
「こういう順番で動いてるんだな」
というイメージを持つだけでも大きな一歩です！

他にも「この仕組みが気になる」部分があれば、また記事にしていこうと思います 💪
